{"ast":null,"code":"import { __extends, __read, __spreadArray } from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\n\nvar Subscriber = function (_super) {\n  __extends(Subscriber, _super);\n\n  function Subscriber(destination) {\n    var _this = _super.call(this) || this;\n\n    _this.isStopped = false;\n\n    if (destination) {\n      _this.destination = destination;\n\n      if (isSubscription(destination)) {\n        destination.add(_this);\n      }\n    } else {\n      _this.destination = EMPTY_OBSERVER;\n    }\n\n    return _this;\n  }\n\n  Subscriber.create = function (next, error, complete) {\n    return new SafeSubscriber(next, error, complete);\n  };\n\n  Subscriber.prototype.next = function (value) {\n    if (this.isStopped) {\n      handleStoppedNotification(nextNotification(value), this);\n    } else {\n      this._next(value);\n    }\n  };\n\n  Subscriber.prototype.error = function (err) {\n    if (this.isStopped) {\n      handleStoppedNotification(errorNotification(err), this);\n    } else {\n      this.isStopped = true;\n\n      this._error(err);\n    }\n  };\n\n  Subscriber.prototype.complete = function () {\n    if (this.isStopped) {\n      handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n    } else {\n      this.isStopped = true;\n\n      this._complete();\n    }\n  };\n\n  Subscriber.prototype.unsubscribe = function () {\n    if (!this.closed) {\n      this.isStopped = true;\n\n      _super.prototype.unsubscribe.call(this);\n\n      this.destination = null;\n    }\n  };\n\n  Subscriber.prototype._next = function (value) {\n    this.destination.next(value);\n  };\n\n  Subscriber.prototype._error = function (err) {\n    try {\n      this.destination.error(err);\n    } finally {\n      this.unsubscribe();\n    }\n  };\n\n  Subscriber.prototype._complete = function () {\n    try {\n      this.destination.complete();\n    } finally {\n      this.unsubscribe();\n    }\n  };\n\n  return Subscriber;\n}(Subscription);\n\nexport { Subscriber };\n\nvar SafeSubscriber = function (_super) {\n  __extends(SafeSubscriber, _super);\n\n  function SafeSubscriber(observerOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    var next;\n\n    if (isFunction(observerOrNext)) {\n      next = observerOrNext;\n    } else if (observerOrNext) {\n      next = observerOrNext.next, error = observerOrNext.error, complete = observerOrNext.complete;\n      var context_1;\n\n      if (_this && config.useDeprecatedNextContext) {\n        context_1 = Object.create(observerOrNext);\n\n        context_1.unsubscribe = function () {\n          return _this.unsubscribe();\n        };\n      } else {\n        context_1 = observerOrNext;\n      }\n\n      next = next === null || next === void 0 ? void 0 : next.bind(context_1);\n      error = error === null || error === void 0 ? void 0 : error.bind(context_1);\n      complete = complete === null || complete === void 0 ? void 0 : complete.bind(context_1);\n    }\n\n    _this.destination = {\n      next: next ? wrapForErrorHandling(next, _this) : noop,\n      error: wrapForErrorHandling(error !== null && error !== void 0 ? error : defaultErrorHandler, _this),\n      complete: complete ? wrapForErrorHandling(complete, _this) : noop\n    };\n    return _this;\n  }\n\n  return SafeSubscriber;\n}(Subscriber);\n\nexport { SafeSubscriber };\n\nfunction wrapForErrorHandling(handler, instance) {\n  return function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    try {\n      handler.apply(void 0, __spreadArray([], __read(args)));\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        if (instance._syncErrorHack_isSubscribing) {\n          instance.__syncError = err;\n        } else {\n          throw err;\n        }\n      } else {\n        reportUnhandledError(err);\n      }\n    }\n  };\n}\n\nfunction defaultErrorHandler(err) {\n  throw err;\n}\n\nfunction handleStoppedNotification(notification, subscriber) {\n  var onStoppedNotification = config.onStoppedNotification;\n  onStoppedNotification && timeoutProvider.setTimeout(function () {\n    return onStoppedNotification(notification, subscriber);\n  });\n}\n\nexport var EMPTY_OBSERVER = {\n  closed: true,\n  next: noop,\n  error: defaultErrorHandler,\n  complete: noop\n};","map":{"version":3,"sources":["../../../src/internal/Subscriber.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __extends, __read, __spreadArray } from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\nvar Subscriber = (function (_super) {\n    __extends(Subscriber, _super);\n    function Subscriber(destination) {\n        var _this = _super.call(this) || this;\n        _this.isStopped = false;\n        if (destination) {\n            _this.destination = destination;\n            if (isSubscription(destination)) {\n                destination.add(_this);\n            }\n        }\n        else {\n            _this.destination = EMPTY_OBSERVER;\n        }\n        return _this;\n    }\n    Subscriber.create = function (next, error, complete) {\n        return new SafeSubscriber(next, error, complete);\n    };\n    Subscriber.prototype.next = function (value) {\n        if (this.isStopped) {\n            handleStoppedNotification(nextNotification(value), this);\n        }\n        else {\n            this._next(value);\n        }\n    };\n    Subscriber.prototype.error = function (err) {\n        if (this.isStopped) {\n            handleStoppedNotification(errorNotification(err), this);\n        }\n        else {\n            this.isStopped = true;\n            this._error(err);\n        }\n    };\n    Subscriber.prototype.complete = function () {\n        if (this.isStopped) {\n            handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n        }\n        else {\n            this.isStopped = true;\n            this._complete();\n        }\n    };\n    Subscriber.prototype.unsubscribe = function () {\n        if (!this.closed) {\n            this.isStopped = true;\n            _super.prototype.unsubscribe.call(this);\n            this.destination = null;\n        }\n    };\n    Subscriber.prototype._next = function (value) {\n        this.destination.next(value);\n    };\n    Subscriber.prototype._error = function (err) {\n        try {\n            this.destination.error(err);\n        }\n        finally {\n            this.unsubscribe();\n        }\n    };\n    Subscriber.prototype._complete = function () {\n        try {\n            this.destination.complete();\n        }\n        finally {\n            this.unsubscribe();\n        }\n    };\n    return Subscriber;\n}(Subscription));\nexport { Subscriber };\nvar SafeSubscriber = (function (_super) {\n    __extends(SafeSubscriber, _super);\n    function SafeSubscriber(observerOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        var next;\n        if (isFunction(observerOrNext)) {\n            next = observerOrNext;\n        }\n        else if (observerOrNext) {\n            (next = observerOrNext.next, error = observerOrNext.error, complete = observerOrNext.complete);\n            var context_1;\n            if (_this && config.useDeprecatedNextContext) {\n                context_1 = Object.create(observerOrNext);\n                context_1.unsubscribe = function () { return _this.unsubscribe(); };\n            }\n            else {\n                context_1 = observerOrNext;\n            }\n            next = next === null || next === void 0 ? void 0 : next.bind(context_1);\n            error = error === null || error === void 0 ? void 0 : error.bind(context_1);\n            complete = complete === null || complete === void 0 ? void 0 : complete.bind(context_1);\n        }\n        _this.destination = {\n            next: next ? wrapForErrorHandling(next, _this) : noop,\n            error: wrapForErrorHandling(error !== null && error !== void 0 ? error : defaultErrorHandler, _this),\n            complete: complete ? wrapForErrorHandling(complete, _this) : noop,\n        };\n        return _this;\n    }\n    return SafeSubscriber;\n}(Subscriber));\nexport { SafeSubscriber };\nfunction wrapForErrorHandling(handler, instance) {\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        try {\n            handler.apply(void 0, __spreadArray([], __read(args)));\n        }\n        catch (err) {\n            if (config.useDeprecatedSynchronousErrorHandling) {\n                if (instance._syncErrorHack_isSubscribing) {\n                    instance.__syncError = err;\n                }\n                else {\n                    throw err;\n                }\n            }\n            else {\n                reportUnhandledError(err);\n            }\n        }\n    };\n}\nfunction defaultErrorHandler(err) {\n    throw err;\n}\nfunction handleStoppedNotification(notification, subscriber) {\n    var onStoppedNotification = config.onStoppedNotification;\n    onStoppedNotification && timeoutProvider.setTimeout(function () { return onStoppedNotification(notification, subscriber); });\n}\nexport var EMPTY_OBSERVER = {\n    closed: true,\n    next: noop,\n    error: defaultErrorHandler,\n    complete: noop,\n};\n//# sourceMappingURL=Subscriber.js.map"]},"metadata":{},"sourceType":"module"}